# Quickstart Guide: Heat Mechanics

**Feature**: Heat Mechanics Integration  
**Phase**: 1 (Design & Contracts)  
**Date**: 2026-01-02

## Overview

Heat mechanics provide thermal risk assessment during route planning. When you specify a ship with
the `--ship` flag, the CLI automatically calculates heat generation for each jump and displays
cumulative heat relative to the ship's heat tolerance.

---

## Basic Usage

### Enable Heat Projections

Heat calculations are automatically enabled when you provide ship data:

```bash
evefrontier-cli route Nod Brana --ship Reflex
```

**Output**:

```text
Route: Nod → Brana (3 hops, algorithm: a-star)
  0: Nod (30000001; min 2.73K, 2 planets, 2 moons)
  1: D:2NAS (30000003; min 2.73K, 4 planets, 9 moons)

      [Jump 18.95 ly] [Fuel: 23.47 (23.47 / 1,750)] [Heat: +88.96 (cumulative: 88.96 units)]
    2: G:3OA0 (30000004; min 2.73K, 3 planets, 7 moons)
      [Jump 38.26 ly] [Fuel: 47.38 (70.85 / 1,750)] [Heat: +179.73 (cumulative: 268.69 units)]
    3: Brana (30000002; min 2.73K, 3 planets, 7 moons)
      [Jump 23.09 ly] [Fuel: 28.59 (99.44 / 1,750)] [Heat: +108.39 (cumulative: 377.08 units)]

via 0 gates / 3 jump drive
Ship: Reflex | Fuel: 99.44 / 1,750 (5.7%) | Heat: 377.08 units
```

**Interpretation**:

- `Heat: +88.96` = Heat generated by this hop
- `(88.96 / 1,000)` = Cumulative heat / ship's max heat tolerance
- `Heat: 377.08 / 1,000 (37.7%)` = Total route heat is 37.7% of max tolerance

---

## Mass Modes

### Static Mass Mode (Default)

Uses initial total mass for all hops (simpler, slight overestimation):

```bash
evefrontier-cli route Nod Brana --ship Reflex
```

**Behavior**:

- Mass = hull + fuel_load + cargo (constant throughout route)
- Simpler calculation, conservative estimate
- Suitable for most route planning

### Dynamic Mass Mode

Recalculates mass after each hop as fuel is consumed (more accurate):

```bash
evefrontier-cli route Nod Brana --ship Reflex --dynamic-mass
```

**Behavior**:

- Mass decreases as fuel consumed (hull + remaining_fuel + cargo)
- More accurate, especially for long routes
- Heat generation decreases slightly on later hops

**Comparison**: | Mode | Total Heat | Difference | |------|-----------|------------| | Static |
377.08 | Baseline | | Dynamic | 376.50 | -0.15% (0.58 units lower) |

**When to use dynamic mode**:

- Long routes with significant fuel consumption (>20% of tank)
- Routes where heat tolerance is tight (>80% of max)
- Scientific accuracy required for route planning tools

---

## Cargo Impact

Cargo mass affects both fuel consumption and heat generation:

```bash
# Empty cargo (minimum mass)
evefrontier-cli route Nod Brana --ship Reflex --cargo-mass 0

# Full cargo (maximum mass)
evefrontier-cli route Nod Brana --ship Reflex --cargo-mass 1000000
```

**Example** (Reflex, Nod → D:2NAS, 18.95 ly): | Cargo Mass (kg) | Total Mass (kg) | Heat Generated |
|-----------------|-----------------|----------------| | 0 | 10,001,750 | 71.88 | | 633,006
(default) | 12,383,006 | 88.96 | | 1,000,000 | 13,001,750 | 93.37 |

**Impact**: +1M kg cargo → +21.49 additional heat (29.9% increase)

---

## Heat Warnings

Warnings are emitted when the instantaneous temperature experienced during a jump
(system ambient minimum external temperature + the hop's temperature delta) crosses the canonical
thresholds. To make warnings highly visible in the CLI we use concise, styled labels:

- ` OVERHEATED ` — black text on yellow background when instantaneous temperature >=
  `HEAT_OVERHEATED` (90.0)
- ` CRITICAL ` — black text on red background when instantaneous temperature >=
  `HEAT_CRITICAL` (150.0)

Example (CLI):

```text
Route: SystemA → SystemB (8 hops, algorithm: a-star)
  ...
  7: SystemH (30000123) [Jump 45.2 ly] [Heat: +212.34]  CRITICAL 
  8: SystemB (30000456) [Jump 22.1 ly] [Heat: +103.78]  OVERHEATED 

via 0 gates / 8 jump drive
Ship: Reflex | Fuel: 512.34 / 1,750 (29.3%) | Heat: 924.28 units

Notes:

- Labels are shown inline with the step details and also aggregated in the route summary as
  warnings. JSON responses contain the same label strings (plain text) for programmatic
  consumption.
- Cooling/wait advice is still computed from residual heat and the local dissipation model; the
  labels signal instantaneous thermal risk rather than cumulative residual state alone.

---

## Gate Transitions

Gates generate **zero heat** (instantaneous travel, no thermal stress):

```bash
evefrontier-cli route Nod H:2L2S --ship Reflex
```

**Output**:

```text
Route: Nod → H:2L2S (2 hops, algorithm: bfs)
  0: Nod (30000001; min 2.73K, 2 planets, 2 moons)
  1: Brana (30000002; min 2.73K, 3 planets, 7 moons)
     [Gate] [Fuel: 0.00 (0.00 / 1,750)] [Heat: +0.00 (0.00 / 1,000)]
  2: H:2L2S (30000005; min 2.73K, 3 planets, 8 moons)
     [Gate] [Fuel: 0.00 (0.00 / 1,750)] [Heat: +0.00 (0.00 / 1,000)]

via 2 gates / 0 jump drive
Ship: Reflex | Fuel: 0.00 / 1,750 (0.0%) | Heat: 0.00 / 1,000 (0.0%)
```

**Note**: Gate-only routes have zero fuel cost and zero heat generation.

---

## JSON Output

### Full Route with Heat Data

```bash
evefrontier-cli route Nod Brana --ship Reflex --format json
```

**Output** (excerpt):

```json
{
  "kind": "route",
  "algorithm": "a-star",
  "hops": 3,
  "steps": [
    {
      "index": 0,
      "id": 30000001,
      "name": "Nod",
      "heat": null
    },
    {
      "index": 1,
      "id": 30000003,
      "name": "D:2NAS",
      "distance": 18.95,
      "method": "jump",
      "heat": {
        "hop_heat": 88.96,
        "cumulative_heat": 88.96,
        "warning": null
      }
    },
    {
      "index": 2,
      "id": 30000004,
      "name": "G:3OA0",
      "distance": 38.26,
      "method": "jump",
      "heat": {
        "hop_heat": 179.73,
        "cumulative_heat": 268.69,
        "warning": null
      }
    },
    {
      "index": 3,
      "id": 30000002,
      "name": "Brana",
      "distance": 23.09,
      "method": "jump",
      "heat": {
        "hop_heat": 108.39,
        "cumulative_heat": 377.08,
        "warning": null
      }
    }
  ],
  "heat": {
    "total": 377.08,
    "warnings": [],
    "warnings": []
  }
}
```

**Use Cases**:

- Programmatic route analysis
- Integration with external tools
- Route database storage

---

## Lambda API

### Request with Ship Data

```bash
curl -X POST https://api.example.com/route \
  -H "Content-Type: application/json" \
  -d '{
    "start": "Nod",
    "goal": "Brana",
    "ship": "Reflex",
    "fuel_load": 1750,
    "cargo_mass_kg": 633006,
    "dynamic_mass": false
  }'
```

### Response with Heat Data

```json
{
  "route": {
    "kind": "route",
    "algorithm": "a-star",
    "hops": 3,
    "steps": [
      {
        "index": 1,
        "id": 30000003,
        "name": "D:2NAS",
        "heat": {
          "hop_heat": 88.96,
          "cumulative_heat": 88.96,
          "warning": null
        }
      }
    ],
    "heat": {
      "total": 377.08,
      "warnings": []
    }
  }
}
```

---

## Advanced Examples

### Compare Ships by Heat Generation

```bash
# Lightweight ship (Reflex)
evefrontier-cli route Nod Brana --ship Reflex

# Heavier ship (Forager, hypothetical)
evefrontier-cli route Nod Brana --ship Forager
```

**Comparison**: | Ship | Hull Mass (kg) | Heat Tolerance | Route Heat | Percentage |
|------|---------------|----------------|------------|------------| | Reflex | 10,000,000 | 1,000 |
377.08 | 37.7% | | Forager | 15,000,000 | 1,500 | 565.62 | 37.7% |

**Insight**: Heavier ships generate more absolute heat but have proportionally higher tolerance
(same percentage).

### Maximum Distance Without Heat Damage

```bash
# Find maximum distance for single jump
# (Heat = 1000 units, Ship: Reflex, Mass: 12,383,006 kg)
# Formula: distance = (heat × C × hull_mass) / (3 × total_mass)
# distance = (1000 × 1.0 × 10,000,000) / (3 × 12,383,006)
# distance ≈ 269.17 ly
```

**Test**:

```bash
evefrontier-cli route SystemA SystemB --ship Reflex --max-jump 269
```

**Result**: Single jump at tolerance limit (100%).

---

## Troubleshooting

### Heat Data Not Displayed

**Symptom**: No heat information in route output.

**Cause**: `--ship` flag not provided.

**Solution**:

```bash
# Incorrect (no heat data)
evefrontier-cli route Nod Brana

# Correct (includes heat data)
evefrontier-cli route Nod Brana --ship Reflex
```

### Heat Exceeds Tolerance

**Symptom**: Error message "Heat exceeds tolerance limit (100%)".

**Solutions**:

1. **Split route**: Plan route in segments with cooldown periods
2. **Use gates**: Prefer gate-connected routes (zero heat)
3. **Lighter ship**: Choose ship with lower mass or higher heat tolerance
4. **Reduce cargo**: Decrease cargo mass to lower total mass

### Heat Values Differ from Community Tools

**Symptom**: Calculated heat doesn't match external tools.

**Cause**: Different calibration constant or formula version.

**Verification**:

```bash
# Our formula: heat = (3 × mass × distance) / (C × hull_mass)
# C = 1.0 (default)
# Check against: https://ef-map.com/blog/jump-calculators-heat-fuel-range
```

**Note**: If discrepancy persists, open an issue with specific test case.

---

## References

- `docs/HEAT_MECHANICS.md` — Heat formula details
- `specs/020-heat/data-model.md` — Data structures
- `specs/020-heat/contracts/heat_response.json` — JSON schema
- https://ef-map.com/blog/jump-calculators-heat-fuel-range — Community calculator

---

## Cooling & Wait Examples

The planner can recommend waiting at a cold location (outermost moon/planet) to dissipate heat
before attempting the next jump. Use `--ship` to enable heat projections and see wait time estimates
in the output.

### Example: Wait required and feasible

```bash
# Route where a hop would push heat near critical; planner suggests waiting at a cold body
evefrontier-cli route Nod Brana --ship Reflex --dynamic-mass
```

**Output**:

```text
Route: Nod → Brana (3 hops, algorithm: a-star)
  0: Nod (30000001; min 2.73K)
  1: D:2NAS (30000003; min 2.73K) [Jump 18.95 ly] [Heat: +88.96 (88.96 / 1,000)]
  2: G:3OA0 (30000004; min 2.73K) [Jump 38.26 ly] [Heat: +179.73 (268.69 / 1,000)]
  3: Brana (30000002; min 2.73K) [Jump 150.00 ly] [Heat: +820.00 (1,088.69 / 1,000)] ❌
    Suggested action: WAIT at outermost body in Brana for 5m to cool to safe level

via 0 gates / 3 jump drive
Ship: Reflex | Fuel: 1200.00 / 1,750 (68.6%) | Heat: 1,088.69 / 1,000 (108.9%) ❌
❌  ERROR: Heat exceeds tolerance limit (100%) - route may damage ship
```

In this case the planner indicates a jump that would exceed the ship's tolerance and suggests
waiting 5m at the coldest local body to dissipate enough heat to attempt the jump safely.

### Example: Wait required but infeasible

```bash
# If external temperature is too high or dissipation rate is zero, the planner marks the hop infeasible
evefrontier-cli route HotSystem Distant --ship Reflex
```

**Output**:

```text
Route: HotSystem → Distant (1 hop, algorithm: a-star)
  0: HotSystem (30001000; min 140.0K)
  1: Distant (30002000; min 143.0K) [Jump 300.00 ly] [Heat: +3000.00 (3,000 units)] ❌
    Cannot safe the jump by waiting here (no effective cooling available)

via 0 gates / 1 jump drive
Ship: Reflex | Fuel: 1200.00 / 1,750 (68.6%) | Heat: 3,000.00 units ❌
❌  ERROR: Heat exceeds critical threshold (>= 150.0) - route not feasible from current position
```

### JSON Output: Cooling fields

When using `--format json` the planner includes cooling-related fields for programmatic consumers:

```bash
evefrontier-cli route Nod Brana --ship Reflex --format json
```

**Output** (excerpt):

```json
{
  "steps": [
    {
      "index": 2,
      "id": 30000004,
        "heat": {
          "hop_heat": 179.73,
          "cumulative_heat": 268.69,
          "wait_time_seconds": null,
          "cooled_cumulative_heat": null,
          "can_proceed": true,
          "warning": null
        }
    },
    {
      "index": 3,
      "id": 30000002,
      "heat": {
        "hop_heat": 820.0,
        "cumulative_heat": 1_088.69,
        "wait_time_seconds": 5400.0,
        "cooled_cumulative_heat": 999.99,
        "can_proceed": true
      }
    }
  ],
        "heat": {
          "total": 1088.69,
          "warnings": ["Heat exceeds critical threshold (>= 150.0)"],
          "recommendations": ["Wait 5400s at outermost body to cool to safe level"]
        }
}
```

Note: `wait_time_seconds` and `cooled_cumulative_heat` are present when a recommended wait is
required; `can_proceed` indicates whether waiting at the local coldest body can reduce cumulative
heat below the critical threshold.

---
