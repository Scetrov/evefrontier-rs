{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Heat Mechanics API Contract",
  "description": "JSON schema for heat-related fields in Lambda route responses",
  "definitions": {
    "HeatProjection": {
      "type": "object",
      "description": "Per-hop heat data for a route step",
      "required": ["hop_heat", "cumulative_heat"],
      "properties": {
        "hop_heat": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "description": "Heat generated by this specific hop (units)"
        },
        "cumulative_heat": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "description": "Total accumulated heat up to this point (units)"
        },
        "warning": {
          "type": "string",
          "nullable": true,
          "description": "Warning message if threshold exceeded (e.g., 'Approaching heat limit')"
        }
      },
      "example": {
        "hop_heat": 88.96,
        "cumulative_heat": 88.96,
        "warning": null
      }
    },
    "HeatSummary": {
      "type": "object",
      "description": "Route-level heat aggregate",
      "required": ["total"],
      "properties": {
        "total": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "description": "Total heat generated across entire route (units)"
        },
        "warnings": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Aggregate warnings (e.g., 'Heat exceeds critical threshold')"
        }
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Aggregate warnings (e.g., 'Heat exceeds safe threshold')"
        }
      },
      "example": {
        "total": 377.08,
        "warnings": []
      }
    },
    "RouteStep": {
      "type": "object",
      "description": "Single step in a planned route (extended with heat field)",
      "required": ["index", "id"],
      "properties": {
        "index": {
          "type": "integer",
          "minimum": 0,
          "description": "Step index in route (0 = origin)"
        },
        "id": {
          "type": "integer",
          "description": "Solar system ID"
        },
        "name": {
          "type": "string",
          "nullable": true,
          "description": "Solar system name"
        },
        "distance": {
          "type": "number",
          "format": "double",
          "nullable": true,
          "description": "Distance in light-years to this step from previous (null for origin)"
        },
        "method": {
          "type": "string",
          "enum": ["gate", "jump"],
          "nullable": true,
          "description": "How this step was reached (null for origin)"
        },
        "min_external_temp": {
          "type": "number",
          "format": "double",
          "nullable": true,
          "description": "Minimum external temperature (Kelvin)"
        },
        "planet_count": {
          "type": "integer",
          "nullable": true,
          "description": "Number of planets in system"
        },
        "moon_count": {
          "type": "integer",
          "nullable": true,
          "description": "Number of moons in system"
        },
        "fuel": {
          "$ref": "#/definitions/FuelProjection",
          "description": "Fuel projection for this hop (if ship data provided)"
        },
        "heat": {
          "$ref": "#/definitions/HeatProjection",
          "description": "Heat projection for this hop (if ship data provided)"
        }
      }
    },
    "RouteSummary": {
      "type": "object",
      "description": "Complete route summary (extended with heat field)",
      "required": [
        "kind",
        "algorithm",
        "hops",
        "gates",
        "jumps",
        "total_distance",
        "jump_distance",
        "start",
        "goal",
        "steps"
      ],
      "properties": {
        "kind": {
          "type": "string",
          "enum": ["route"],
          "description": "Output kind"
        },
        "algorithm": {
          "type": "string",
          "enum": ["bfs", "dijkstra", "a-star"],
          "description": "Algorithm used"
        },
        "hops": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of hops"
        },
        "gates": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of gate transitions"
        },
        "jumps": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of jump drive uses"
        },
        "total_distance": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "description": "Total distance (light-years)"
        },
        "jump_distance": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "description": "Distance covered by jump drive (light-years)"
        },
        "start": {
          "$ref": "#/definitions/RouteEndpoint"
        },
        "goal": {
          "$ref": "#/definitions/RouteEndpoint"
        },
        "steps": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/RouteStep"
          }
        },
        "fuel": {
          "$ref": "#/definitions/FuelSummary",
          "description": "Fuel summary (if ship data provided)"
        },
        "heat": {
          "$ref": "#/definitions/HeatSummary",
          "description": "Heat summary (if ship data provided)"
        },
        "fmap_url": {
          "type": "string",
          "nullable": true,
          "description": "fmap URL token for sharing/bookmarking"
        }
      }
    },
    "RouteEndpoint": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": {
          "type": "integer",
          "description": "Solar system ID"
        },
        "name": {
          "type": "string",
          "nullable": true,
          "description": "Solar system name"
        }
      }
    },
    "FuelProjection": {
      "type": "object",
      "description": "Fuel projection (existing, included for completeness)",
      "required": ["hop_cost", "cumulative"],
      "properties": {
        "hop_cost": {
          "type": "integer",
          "minimum": 0,
          "description": "Hop fuel cost in whole units"
        },
        "cumulative": {
          "type": "integer",
          "minimum": 0,
          "description": "Cumulative fuel in whole units"
        },
        "remaining": {
          "type": "integer",
          "nullable": true,
          "minimum": 0,
          "description": "Remaining fuel in whole units"
        },
        "warning": {
          "type": "string",
          "nullable": true
        }
      }
    },
    "FuelSummary": {
      "type": "object",
      "description": "Fuel summary (existing, included for completeness)",
      "required": ["total"],
      "properties": {
        "total": {
          "type": "integer",
          "minimum": 0,
          "description": "Total fuel projection in whole units"
        },
        "remaining": {
          "type": "integer",
          "nullable": true,
          "minimum": 0,
          "description": "Remaining fuel in whole units"
        },
        "ship_name": {
          "type": "string",
          "nullable": true
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
